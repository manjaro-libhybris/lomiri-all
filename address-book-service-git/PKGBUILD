# Maintainer: Furkan Kardame <furkan@fkardame.com>

pkgname=address-book-service-git
_pkgname=address-book-service
pkgver=r947.f7e699c
pkgrel=10
pkgdesc='Ubuntu contact service'
url='https://gitlab.com/ubports/development/core/address-book-service'
arch=(x86_64 i686 armv7h aarch64)
license=()
depends=(libaccounts-qt folks libgee url-dispatcher qt5-pim-git qt5-es2-base ayatana-indicator-messages-git libphonenumber lomiri-ui-toolkit-git buteo-syncfw-qml-git)
makedepends=(git cmake vala)
source=('git+https://gitlab.com/ubports/development/core/address-book-service'
        0001-Update-for-libebook-3.33.2.patch
        0001-Make-sure-target-link-is-public-and-add-missing-libr.patch)
sha256sums=('SKIP'
            'b25e82331c638b229266a94c37a8c06bf92f810d8683090ac9834f497b8f6d61'
            '34d2497926955875c29398852d0b0762105f46cc263e322cb8710bc63eaa287b')

pkgver() {
 cd ${_pkgname}
 printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

prepare() {
  cd ${_pkgname}
  # patches here
  patch -p1 -i ../0001-Update-for-libebook-3.33.2.patch
  patch -p1 -i ../0001-Make-sure-target-link-is-public-and-add-missing-libr.patch
}

build() {
  cd ${_pkgname}
  mkdir -p build
  cd build
  cmake ../ -DCMAKE_INSTALL_PREFIX:PATH=/usr -DCMAKE_INSTALL_LIBDIR="lib/" -DCMAKE_INSTALL_SYSCONFDIR=/etc -DCMAKE_INSTALL_LOCALSTATEDIR=/var
  make

}

package() {
  cd ${_pkgname}/build
  make DESTDIR="${pkgdir}/" install
  mv "${pkgdir}/usr/lib/qt5/" "${pkgdir}/usr/lib/qt/"
}
