From fdbd6b346782d68bea2e94d2adb9c799f7395d9b Mon Sep 17 00:00:00 2001
From: Marius Gripsgard <marius@ubports.com>
Date: Fri, 14 Aug 2020 21:10:52 +0200
Subject: [PATCH] Install systemd unit with cmake not just debian pkg

---
 data/CMakeLists.txt               | 11 +++++++++++
 {debian => data}/repowerd.service |  0
 2 files changed, 11 insertions(+)
 rename {debian => data}/repowerd.service (100%)

diff --git a/data/CMakeLists.txt b/data/CMakeLists.txt
index 7cac25e..b00c5cc 100644
--- a/data/CMakeLists.txt
+++ b/data/CMakeLists.txt
@@ -16,6 +16,7 @@
 
 FILE(GLOB device_config_files "${CMAKE_CURRENT_SOURCE_DIR}/device-configs/*.xml")
 FILE(GLOB dbus_config_files "${CMAKE_CURRENT_SOURCE_DIR}/dbus-configs/*.conf")
+FILE(GLOB systemd_file "${CMAKE_CURRENT_SOURCE_DIR}/repowerd.service")
 
 install(
   FILES ${device_config_files}
@@ -26,3 +27,13 @@ install(
   FILES ${dbus_config_files}
   DESTINATION ${CMAKE_INSTALL_FULL_SYSCONFDIR}/dbus-1/system.d
 )
+
+pkg_check_modules(SYSTEMD systemd)
+if (${SYSTEMD_FOUND})
+  pkg_get_variable(SYSTEMD_SYSTEM_DIR systemd systemdsystemunitdir)
+  message (STATUS "${SYSTEMD_SYSTEM_DIR} is the systemd system unit file install dir")
+  message(STATUS "${systemd_file} is your file")
+  # install it
+  install (FILES "${systemd_file}"
+           DESTINATION "${SYSTEMD_SYSTEM_DIR}")
+endif()
diff --git a/debian/repowerd.service b/data/repowerd.service
similarity index 100%
rename from debian/repowerd.service
rename to data/repowerd.service
-- 
2.25.1

