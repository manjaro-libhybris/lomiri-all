# Maintainer: Furkan Kardame <furkan@fkardame.com>

pkgname="lomiri-indicator-bluetooth-git"
_pkgname="indicator-bluetooth"
_srcname=${_pkgname}
pkgver=git_r226
pkgrel=2
pkgdesc="Bluetooth Indicator"
arch=("i686" "x86_64" "aarch64")
url="https://github.com/ubports/indicator-bluetooth"
license=("GPL3")
depends=("glib2" "accountsservice" "hicolor-icon-theme" "dconf" "url-dispatcher-git")
makedepends=("debianutils" "gnome-common" "systemd" "intltool" "accountsservice" "vala" "glib2" "gio-qt" "git")
optdepends=("")
source=("git+https://github.com/ubports/${_pkgname}.git"
        "fix-systemd.patch"
        "0001-bluez-Set-Powerd-prop-regardless-if-rfkill-is-writab.patch")
md5sums=("SKIP"
        "44ebaa85e56ba03c5770a1ccdb183ca7"
        "SKIP")
options=("!emptydirs")
provides=("${_pkgname}")
conflicts=("${_pkgname}")

pkgver()
{
    cd ${_srcname}
    echo "git_r$(git rev-list --count HEAD)"
}

prepare()
{
    cd ${_srcname}
    patch -Np1 -i "${srcdir}/fix-systemd.patch"
    patch -Np1 -i "${srcdir}/0001-bluez-Set-Powerd-prop-regardless-if-rfkill-is-writab.patch"
    NOCONFIGURE=1 ./autogen.sh
}

build()
{
    cd ${_srcname}
    ./configure --prefix=/usr --libexecdir=/usr/lib --enable-gtk-doc --disable-tests --disable-static
    make
}

package()
{
    cd ${_srcname}
    make DESTDIR="${pkgdir}" install
    find ${pkgdir}/usr/lib -name *.la -delete
}
